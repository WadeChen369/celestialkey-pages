
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Celestial Key å‘½ç†è§£èªªæŸ¥è©¢å…¥å£</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <h1>ğŸ”® Celestial Key å‘½ç†è§£èªªæŸ¥è©¢å…¥å£</h1>
  <p>è«‹è¼¸å…¥ä½ çš„ç”Ÿæ—¥ï¼Œæˆ‘å€‘å°‡è‡ªå‹•è¨ˆç®—ä¸»æ•¸ã€æ˜Ÿåº§èˆ‡æµæ—¥ï¼Œå¸¶ä½ æ‰“é–‹ä»Šæ—¥å‘½é‹ä¹‹é‘° âœ¨</p>
  <input type="date" id="birthday" required>
  <button onclick="submitBirthday()">æŸ¥è©¢ä»Šæ—¥å‘½é‹</button>
  <div id="debug" style="margin-top:1rem;color:#666;font-size:.9rem"></div>
  <div id="result"></div>
</div>

<!-- ===== å…§åµŒè…³æœ¬ ===== -->
<script>
/* ------------ è¨ˆç®—å‡½å¼ ------------ */
function calcLifePath(b){
  const digits=b.replace(/\D/g,'').split('').map(Number);
  let s=digits.reduce((a,b)=>a+b,0);
  const master=[11,22,33];
  if(master.includes(s)) return s;
  while(s>=10) s=s.toString().split('').reduce((a,b)=>a+Number(b),0);
  return s;
}
function getZodiac(m,d){
  if((m==1&&d>=20)||(m==2&&d<=18))  return 'æ°´ç“¶';
  if((m==2&&d>=19)||(m==3&&d<=20))  return 'é›™é­š';
  if((m==3&&d>=21)||(m==4&&d<=19))  return 'ç‰¡ç¾Š';
  if((m==4&&d>=20)||(m==5&&d<=20))  return 'é‡‘ç‰›';
  if((m==5&&d>=21)||(m==6&&d<=20))  return 'é›™å­';
  if((m==6&&d>=21)||(m==7&&d<=22))  return 'å·¨èŸ¹';
  if((m==7&&d>=23)||(m==8&&d<=22))  return 'ç…å­';
  if((m==8&&d>=23)||(m==9&&d<=22))  return 'è™•å¥³';
  if((m==9&&d>=23)||(m==10&&d<=22)) return 'å¤©ç§¤';
  if((m==10&&d>=23)||(m==11&&d<=21))return 'å¤©è ';
  if((m==11&&d>=22)||(m==12&&d<=21))return 'å°„æ‰‹';
  return 'æ‘©ç¾¯';
}
function calcFlowDay(dateObj){
  const str=dateObj.toISOString().slice(0,10).replace(/\D/g,'');
  const sum=str.split('').map(Number).reduce((a,b)=>a+b,0);
  return (sum%9)||9;
}

/* ------------ ä¸»æµç¨‹ ------------ */
async function submitBirthday(){
  const debugEl=document.getElementById('debug');
  debugEl.innerHTML='';
  const bday=document.getElementById('birthday').value;
  const resEl=document.getElementById('result');
  if(!/^\d{4}-\d{2}-\d{2}$/.test(bday)){
    resEl.textContent='è«‹è¼¸å…¥æ­£ç¢ºç”Ÿæ—¥ (YYYY-MM-DD)';
    return;
  }
  const lp=calcLifePath(bday);
  const bd=new Date(bday);
  const zodiac=getZodiac(bd.getMonth()+1, bd.getDate());
  const batch='2025-05-03';              // DEMO æ‰¹æ¬¡
  const flow=calcFlowDay(new Date(batch)); // =8
  const file=`${batch}_flowday_${flow}_lifepath_${lp}.json`;
  const url=`daily/${batch}/${file}`;

  debugEl.innerHTML=
    `<strong>ç”Ÿå‘½è·¯å¾‘æ•¸ï¼š</strong>${lp}<br>`+
    `<strong>æ˜Ÿåº§ï¼š</strong>${zodiac}<br>`+
    `<strong>æµæ—¥ï¼š</strong>${flow}<br>`+
    `<strong>æª”æ¡ˆè·¯å¾‘ï¼š</strong>${url}<br>`;

  try{
    const resp=await fetch(url);
    if(!resp.ok) throw new Error('æ‰¾ä¸åˆ°æª”æ¡ˆ');
    const raw=await resp.json();
    const arr=Array.isArray(raw)?raw:JSON.parse(raw.file);
    const hit=arr.find(o=>o.sign.startsWith(zodiac));
    if(!hit) throw new Error('æ˜Ÿåº§æ®µè½ç¼ºå¤±');
    resEl.innerHTML=hit.message.replace(/\n/g,'<br>');
  }catch(e){
    resEl.textContent='è®€å–è³‡æ–™å¤±æ•—ï¼š'+e.message;
  }
}

/* ------------ Console å°å·¥å…· ------------ */
function debugPath(b){
  const lp=calcLifePath(b);
  const batch='2025-05-03';
  const flow=calcFlowDay(new Date(batch));
  console.log(`daily/${batch}/${batch}_flowday_${flow}_lifepath_${lp}.json`);
}
</script>
</body>
</html>
